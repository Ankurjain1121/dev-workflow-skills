# PostToolUse Hook Generation for /fix-hard

This template generates Claude Code hooks for continuous quality enforcement.

## Usage

Run `/fix-hard --setup-hooks` to install these hooks.

## Generated Files

### .claude/settings.local.json

```json
{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Edit|Write|MultiEdit",
        "hooks": [
          {
            "type": "command",
            "command": "bash .claude/hooks/post-edit-lint.sh \"$CLAUDE_FILE_PATH\""
          }
        ]
      }
    ],
    "PreToolUse": [
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "bash .claude/hooks/pre-bash-check.sh \"$CLAUDE_TOOL_INPUT\""
          }
        ]
      }
    ]
  }
}
```

### .claude/hooks/post-edit-lint.sh

```bash
#!/bin/bash
# Auto-lint and format after every file edit
# Generated by /fix-hard --setup-hooks

FILE="$1"
EXIT_CODE=0

# Skip if file doesn't exist or is in excluded paths
if [ ! -f "$FILE" ]; then
  exit 0
fi

case "$FILE" in
  node_modules/*|dist/*|build/*|.git/*|vendor/*)
    exit 0
    ;;
esac

# TypeScript/JavaScript
case "$FILE" in
  *.ts|*.tsx|*.js|*.jsx)
    echo "[hook] Linting $FILE..."
    npx eslint "$FILE" --fix --max-warnings 0 2>/dev/null || EXIT_CODE=1

    echo "[hook] Formatting $FILE..."
    npx prettier "$FILE" --write 2>/dev/null
    ;;
esac

# Python
case "$FILE" in
  *.py)
    echo "[hook] Formatting $FILE..."
    ruff format "$FILE" 2>/dev/null || black "$FILE" 2>/dev/null

    echo "[hook] Linting $FILE..."
    ruff check "$FILE" --fix 2>/dev/null || EXIT_CODE=1
    ;;
esac

# Go
case "$FILE" in
  *.go)
    echo "[hook] Formatting $FILE..."
    gofmt -w "$FILE" 2>/dev/null
    ;;
esac

# Rust
case "$FILE" in
  *.rs)
    echo "[hook] Formatting $FILE..."
    rustfmt "$FILE" 2>/dev/null
    ;;
esac

if [ $EXIT_CODE -ne 0 ]; then
  echo "[hook] ⚠️ Lint errors found in $FILE"
fi

exit $EXIT_CODE
```

### .claude/hooks/pre-bash-check.sh

```bash
#!/bin/bash
# Block dangerous commands and suppression additions
# Generated by /fix-hard --setup-hooks

INPUT="$1"

# Block eslint-disable additions
if echo "$INPUT" | grep -qE "eslint-disable|@ts-ignore|@ts-expect-error|noqa|nolint"; then
  echo "[hook] ❌ BLOCKED: Adding suppression comments is not allowed in /fix-hard mode"
  echo "[hook] Fix the underlying issue instead of suppressing"
  exit 1
fi

# Block force push to main
if echo "$INPUT" | grep -qE "git push.*--force.*(main|master)"; then
  echo "[hook] ❌ BLOCKED: Force push to main/master is not allowed"
  exit 1
fi

exit 0
```

### .claude/hooks/commit-check.sh

```bash
#!/bin/bash
# Pre-commit quality gate
# Generated by /fix-hard --setup-hooks

echo "[hook] Running pre-commit quality checks..."

# Type check
if [ -f "tsconfig.json" ]; then
  echo "[hook] Type checking..."
  npx tsc --noEmit || exit 1
fi

# Lint with zero warnings
echo "[hook] Linting..."
npm run lint -- --max-warnings 0 || exit 1

# Format check
echo "[hook] Checking formatting..."
npx prettier --check "src/**/*.{ts,tsx,js,jsx}" || exit 1

# Security scan (critical only for speed)
echo "[hook] Security scan..."
semgrep scan --config "p/security-audit" --severity ERROR --quiet || exit 1

echo "[hook] ✅ All checks passed!"
exit 0
```

## Installation Script

When `/fix-hard --setup-hooks` is run, execute:

```bash
# Create hooks directory
mkdir -p .claude/hooks

# Write hook files
# (content from templates above)

# Make executable
chmod +x .claude/hooks/*.sh

# Create/update settings
# (merge with existing .claude/settings.local.json)

echo "✅ Hooks installed successfully!"
echo ""
echo "Hooks enabled:"
echo "  - post-edit-lint.sh: Auto-lint after every Edit/Write"
echo "  - pre-bash-check.sh: Block suppression additions"
echo "  - commit-check.sh: Full quality gate before commits"
```

## Disabling Hooks

To temporarily disable:
```bash
mv .claude/settings.local.json .claude/settings.local.json.bak
```

To re-enable:
```bash
mv .claude/settings.local.json.bak .claude/settings.local.json
```
